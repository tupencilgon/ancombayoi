<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ƒÇn C∆°m B√¢y ∆†i</title>
  <link rel="stylesheet" href="app.css" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <h1 class="brand">ƒÇn C∆°m B√¢y ∆†i</h1>
      <nav class="nav">
        <a href="#calc" class="nav-link" data-tab="calc">T√≠nh ti·ªÅn</a>
        <a href="#wheel" class="nav-link" data-tab="wheel">V√≤ng quay</a>
        <a href="#settings" class="nav-link" data-tab="settings">C√†i ƒë·∫∑t</a>
      </nav>
    </div>
  </header>

  <main id="appRoot" class="container">
    <!-- T√çNH TI·ªÄN (M√ÄN H√åNH CH√çNH) -->
    <section id="calc" class="tab active">
      <div class="layout-main">
        <div class="card">
          <div class="card-header">
            <h2 id="formTitle">T·∫°o l·∫ßn ƒëi l·∫•y m·ªõi</h2>
            <span id="editBadge" class="chip hidden">ƒêang ch·ªânh s·ª≠a</span>
          </div>
          <div class="card-body">
            <div class="row">
              <div>
                <label>Ng√†y</label>
                <input id="dateInput" type="date" />
              </div>
              <div>
                <label>Ai ƒëi l·∫•y ƒë·ªì</label>
                <input id="collectorInput" type="text" placeholder="T√™n ng∆∞·ªùi ƒëi l·∫•y" />
              </div>
            </div>

            <div class="row">
              <div>
                <label>T·ªïng ti·ªÅn (VND)</label>
                <input id="totalInput" type="number" inputmode="decimal" min="0" step="1000" placeholder="vd: 350000" />
              </div>
              <div>
                <label>Ch·ªçn ng∆∞·ªùi ƒÉn h√¥m nay (tick nhanh t·ª´ danh s√°ch c·ªë ƒë·ªãnh)</label>
                <div id="rosterChecklist" class="checklist"></div>
                <div class="row-3">
                  <input id="quickAddName" type="text" placeholder="Th√™m nhanh t√™n l·∫ª (tu·ª≥ ch·ªçn)" />
                  <button class="btn ghost" id="addQuickBtn" type="button">+ Th√™m</button>
                </div>
                <div id="quickNamesWrap" class="participants"></div>
              </div>
            </div>

            <div class="btns">
              <button class="btn secondary" id="prepareBtn">T√≠nh & Chu·∫©n b·ªã</button>
              <button class="btn ghost" id="clearBtn" type="button">X√≥a form</button>
            </div>

            <div id="preview" class="hidden">
              <hr />
              <div class="row">
                <div>
                  <div class="muted">S·ªë ng∆∞·ªùi</div>
                  <div class="chip"><span id="numPeopleOut">0</span></div>
                </div>
                <div>
                  <div class="muted">M·ªói ng∆∞·ªùi</div>
                  <div class="chip mono" id="perPersonOut">0 ‚Ç´</div>
                </div>
              </div>

              <div class="participants" id="participantsEditor"></div>

              <div class="btns">
                <button class="btn" id="saveBtn">L∆∞u v√†o Firestore</button>
                <button class="btn ghost" id="cancelEditBtn">H·ªßy ch·ªânh s·ª≠a</button>
              </div>
            </div>

            <p class="muted">üí° Tick nhanh t·ª´ danh s√°ch c·ªë ƒë·ªãnh. V√†o tab <b>C√†i ƒë·∫∑t</b> ƒë·ªÉ th√™m/xo√° ng∆∞·ªùi.</p>
          </div>
        </div>

        <!-- L·ªäCH S·ª¨ (V·ªöI N√öT L·ªåC + OVERLAY) -->
        <section class="card">
          <div class="card-header history-header">
            <h2>L·ªãch s·ª≠</h2>
            <button class="btn ghost" id="openFilterBtn">B·ªô l·ªçc</button>
          </div>
          <div class="card-body" style="overflow:auto">
            <table id="historyTable">
              <thead>
                <tr>
                  <th>Ng√†y</th>
                  <th>Ng∆∞·ªùi l·∫•y</th>
                  <th class="right">T·ªïng (‚Ç´)</th>
                  <th class="right">S·ªë ng∆∞·ªùi</th>
                  <th class="right">M·ªói ng∆∞·ªùi (‚Ç´)</th>
                  <th>Danh s√°ch & Tr·∫°ng th√°i tr·∫£</th>
                  <th>H√†nh ƒë·ªông</th>
                </tr>
              </thead>
              <tbody id="historyBody"></tbody>
            </table>
            <div class="stats">
              <div class="chip"><span class="muted">T·ªïng l∆∞·ª£t:</span> <span id="totalTrips">0</span></div>
              <div class="chip"><span class="muted">T·ªïng ti·ªÅn:</span> <span class="mono" id="totalAmount">0 ‚Ç´</span></div>
            </div>
          </div>
        </section>
      </div>
    </section>

    <!-- V√íNG QUAY -->
    <section id="wheel" class="tab">
      <div class="card">
        <div class="card-header"><h2>V√≤ng quay ch·ªçn ng∆∞·ªùi ƒëi l·∫•y</h2></div>
        <div class="card-body">
          <p class="muted">Ch·ªçn ng∆∞·ªùi tham gia v√≤ng quay r·ªìi b·∫•m <b>Quay</b>. Danh s√°ch l·∫•y t·ª´ ‚ÄúC√†i ƒë·∫∑t‚Äù.</p>
          <div id="wheelChecklist" class="checklist"></div>
          <div class="btns">
            <button class="btn ghost" id="resetWheelBtn">B·ªè ch·ªçn</button>
          </div>
         <div class="wheel-wrap">
  <div id="wheelSpinner" class="wheel-spinner">
    <canvas id="wheelCanvas" width="320" height="320"></canvas>

    <!-- TH√äM n√∫t quay v√†o gi·ªØa -->
    <button class="btn spin-center" id="spinBtn">üéØ Quay</button>
  </div>
  <div class="pointer">‚ñ≤</div>
</div>
<!-- L·ªãch s·ª≠ v√≤ng quay -->
          <h3 class="muted" style="margin-top:16px">L·ªãch s·ª≠ quay g·∫ßn ƒë√¢y</h3>
<table id="spinsTable">
  <thead>
    <tr>
      <th>Th·ªùi gian</th>
      <th>Ng∆∞·ªùi tr√∫ng</th>
      <th>·ª®ng vi√™n tham gia</th>
    </tr>
  </thead>
  <tbody id="spinsTbody"></tbody>
</table>

    </section>

    <!-- C√ÄI ƒê·∫∂T (THAY CHO COMING SOON) -->
    <section id="settings" class="tab">
      <div class="card">
        <div class="card-header">
          <h2>C√†i ƒë·∫∑t ‚Äì Danh s√°ch ng∆∞·ªùi ƒÉn</h2>
        </div>
        <div class="card-body">
          <p class="muted">Danh s√°ch tick nhanh d√πng m·ªói ng√†y. M·∫∑c ƒë·ªãnh A‚ÜíI.</p>
          <div id="settingsList" class="participants"></div>
          <div class="row-3">
            <input id="newNameInput" type="text" placeholder="Th√™m ng∆∞·ªùi (vd: T√∫)" />
            <button class="btn secondary" id="addNameBtn">+ Th√™m v√†o danh s√°ch</button>
          </div>
          <div class="btns">
            <button class="btn" id="saveSettingsBtn">L∆∞u danh s√°ch</button>
            <button class="btn ghost" id="resetDefaultBtn">Kh√¥i ph·ª•c m·∫∑c ƒë·ªãnh (A‚ÜíI)</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- OVERLAY L·ªåC L·ªäCH S·ª¨ -->
  <div id="filterOverlay" class="overlay hidden">
    <div class="overlay-backdrop"></div>
    <div class="overlay-panel">
      <div class="panel-header">
        <h3>B·ªô l·ªçc l·ªãch s·ª≠</h3>
        <button id="closeFilterBtn" class="btn ghost small">ƒê√≥ng</button>
      </div>
      <div class="panel-body">
        <div class="row">
          <div>
            <label>T√¨m theo t√™n ng∆∞·ªùi ƒÉn</label>
            <input id="filterName" type="text" placeholder="G√µ t√™n ƒë·ªÉ l·ªçc l·ªãch s·ª≠" />
          </div>
          <div>
            <label>Kho·∫£ng ng√†y (t·ª´)</label>
            <input id="filterFrom" type="date" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>Kho·∫£ng ng√†y (ƒë·∫øn)</label>
            <input id="filterTo" type="date" />
          </div>
          <div style="align-self:end">
            <div class="btns">
              <button class="btn secondary" id="applyFilterBtn">√Åp d·ª•ng l·ªçc</button>
              <button class="btn ghost" id="resetFilterBtn">X√≥a l·ªçc</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container">¬© 2025 ƒÇn C∆°m B√¢y ∆†i</div>
  </footer>

  <script type="module" src="app.js"></script>
  <!-- POPUP CH√öC M·ª™NG NG∆Ø·ªúI TR√öNG -->
<div id="winnerOverlay" class="overlay hidden">
  <div class="overlay-backdrop"></div>
  <div class="overlay-panel" style="max-width:420px">
    <div class="panel-header">
      <h3>üéâ K·∫øt qu·∫£ v√≤ng quay</h3>
      <button id="closeWinnerBtn" class="btn ghost small">ƒê√≥ng</button>
    </div>
    <div class="panel-body" style="text-align:center">
      <div class="chip" style="font-size:18px; padding:10px 14px">
        Ng∆∞·ªùi tr√∫ng: <b id="winnerName"></b>
      </div>
      <p class="muted" style="margin-top:10px">
        ƒê√£ l∆∞u l·ªãch s·ª≠ quay v√†o Firestore.
      </p>
    </div>
  </div>
</div>

</body>
</html>
